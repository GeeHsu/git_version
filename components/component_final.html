<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>元件章節作業</title>
    <!-- Bootstarp 5 CSS CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    />
    <style></style>
  </head>
  <body>
    <div id="app">
      <div class="container py-5">
        <h2>元件章節作業</h2>
        <a
          href="https://api.kcg.gov.tw/ServiceList/Detail/9c8e1450-e833-499c-8320-29b36b7ace5c"
          target="_blank"
          >API 站點說明</a
        >
        <br />
        <a
          href="https://api.kcg.gov.tw/api/service/Get/9c8e1450-e833-499c-8320-29b36b7ace5c"
          target="_blank"
          >API 連結位址</a
        >
        <br />
        <a href="https://github.com/hexschool/KCGTravel" target="_blank"
          >備用位址</a
        >
        <br /><br />
        <a
          href="https://codepen.io/Wcc723/pen/dyOgGvy?editors=1010"
          target="_blank"
          >作業範例</a
        >
        <p>作業條件:</p>
        <ul>
          <li>每張卡片都需要使用元件製作</li>
          <li>分頁需要製作成元件</li>
          <li>分頁需要接收資料 props</li>
          <li>分頁需要可以進行切換 emit</li>
          <li>分頁細節</li>
          <li>Previous, Next 需要可以正確運作 (套用 disabled)</li>
          <li>當前頁面需要套用 .active 的視覺效果</li>
        </ul>
        <div v-if="this.totalPages">
          <div class="row" id="content">
            <card :card-url="displayData"></card>
          </div>
          <div class="d-flex justify-content-center mt-4">
            <pagination
              :current-page="currentPage"
              :total-pages="totalPages"
              @emit-pagination="changePage"
            ></pagination>
          </div>
        </div>
        <div v-else>等待資料抓取中...</div>
      </div>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Bootstrap 5 JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
      const app = Vue.createApp({
        // 資料 (函式)
        data() {
          return {
            spotsData: [],
            displayData: [],
            perPage: 20,
            currentPage: 1,
            totalPages: 0,
          };
        },
        // 生命週期 (函式)
        created() {
          console.log(this);
          this.getData();
          this.pagination();
          this.updateData();
        },
        // 方法 (物件)
        methods: {
          getData() {
            const jsonUrl =
              "https://api.kcg.gov.tw/api/service/Get/9c8e1450-e833-499c-8320-29b36b7ace5c";
            let jsonData = {};

            fetch(jsonUrl, { method: "get" })
              .then((res) => {
                return res.json();
              })
              .then((data) => {
                jsonData = data.data.XML_Head.Infos.Info;
                // console.log(jsonData);
                this.spotsData = jsonData;
                this.pagination();
                this.updateData();
              });
          },
          pagination() {
            const dataTotal = this.spotsData.length;
            console.log(dataTotal);
            this.totalPages = Math.ceil(dataTotal / this.perPage);
          },
          changePage(page) {
            this.currentPage = page;
            this.updateData();
          },
          updateData() {
            const start = (this.currentPage - 1) * this.perPage;
            const end = start + this.perPage;
            this.displayData = this.spotsData.slice(start, end);
          },
        },
      });

      // 卡片元件
      app.component("card", {
        props: ["cardUrl"],
        template: `
        <div class="col-md-6 py-2" v-for="item in cardUrl" :key="item.Name">
            <div class="card bg-dark text-white text-left">
              <img class="card-img-top img-cover" height="155px" :src="item.Picture1">
              <div class="card-img-overlay d-flex justify-content-between align-items-end p-0 px-3" style="background-color: rgba(0, 0, 0, .2)">
                <h5 class="card-img-title-lg">{{ item.Name }}</h5>
                <h5 class="card-img-title-sm">{{ item.Zone }}</h5>
              </div>
            </div>
            <div class="card-body text-left">
                <p class="card-text"><i class="far fa-clock fa-clock-time"></i>&nbsp;
                  {{ item.Opentime }}</p>
                <p class="card-text"><i class="fas fa-map-marker-alt fa-map-gps"></i>&nbsp;
                  {{ item.Add }}</p>
                <p class="card-text"><i class="fas fa-mobile-alt fa-mobile"></i>&nbsp;
                  {{ item.Tel }}
                </p>
                <p class="card-text"><i class="fas fa-tags text-warning"></i>&nbsp; {{ item.Ticketinfo ? item.Ticketinfo : '無' }}</p>
            </div>
        </div>
        `,
      });

      // 分頁元件
      app.component("pagination", {
        props: ["currentPage", "totalPages"],
        methods: {
          changePage(page) {
            this.$emit("emit-pagination", page);
          },
        },
        template: `
        <nav aria-label="Page navigation example" v-if="this.totalPages">
          <ul class="pagination" id="pageid">
            <li class="page-item">
              <a
                href="#"
                @click="changePage(currentPage - 1)"
                :class="{ disabled: currentPage === 1 }"
                class="page-link"
                >Previous</a
              >
            </li>
            <!--當被點擊時changePage會等於被點擊到的值-->
            <li class="page-item" v-for="i in totalPages" :key="i">
              <a
                href="#"
                class="page-link"
                :class="{ active: currentPage === i }"
                @click="changePage(i)"
                >{{i}}</a
              >
            </li>
            <!--當cardsPage小於totalPages時，被點擊可以將頁碼加1-->
            <li class="page-item">
              <a
                href="#"
                class="page-link"
                @click="changePage(currentPage + 1)"
                :class="{ disabled: currentPage === totalPages }"
                >Next</a
              >
            </li>
          </ul>
        </nav>
        `,
      });

      app.mount("#app");
    </script>
  </body>
</html>
