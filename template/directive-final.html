<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>指令章節作業</title>
    <!-- Bootstarp 5 CSS CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <style></style>
  </head>
  <body>
    <div id="app">
      <div class="container py-5 gx-2">
        <h2 class="text-center">指令章節作業</h2>
        <div class="row gx-3 bg-light py-3">
          <div class="col-md-4">
            <div class="list-group">
              <a
                href="#"
                class="list-group-item list-group-item-action"
                v-for="item in products"
                :key="item.name"
                @click.prevent="selectProduct(item)"
                :class="{ 'active': itemSelected.name === item.name }"
              >
                <h6 class="card-title mb-1">{{ item.name }}</h6>
                <div class="d-flex align-items-center justify-content-between">
                  <p class="mb-0"><small>{{ item.engName }}</small></p>
                  <p class="mb-0"><small>NT$ {{ item.price }}</small></p>
                </div>
              </a>
            </div>
          </div>
          <div class="col-md-8">
            <div class="card mb-2">
              <!-- 條件判斷 v-if -->
              <div
                v-if="!itemSelected.hasOwnProperty('name')"
                class="position-absolute text-white d-flex align-items-center justify-content-center"
                style="
                  top: 0;
                  bottom: 0;
                  left: 0;
                  right: 0;
                  background-color: rgba(0, 0, 0, 0.65);
                  z-index: 100;
                "
              >
                請先選擇飲品
              </div>
              <div class="card-body px-4">
                <div class="mb-3">
                  <label for="productNum" class="form-label">數量</label>
                  <input
                    type="number"
                    class="form-control"
                    id="productNum"
                    v-model="itemSelected.count"
                    placeholder="數量"
                    min="0"
                  />
                </div>
                <div class="mb-3">
                  <label for="productIce" class="form-label d-block"
                    >冰塊*</label
                  >
                  <div
                    class="form-check form-check-inline"
                    v-for="(ice, key) in iceType"
                    :key="'ice' + key"
                  >
                    <!-- HTML 屬性綁定 :disabled -->
                    <input
                      class="form-check-input"
                      name="iceType"
                      type="radio"
                      :id="'ice' + key"
                      :value="ice"
                      v-model="itemSelected.ice"
                      :disabled="!itemSelected.hasOwnProperty('defaults') || (itemSelected.defaults.ice !== '' && itemSelected.defaults.ice !== ice)"
                    />
                    <label class="form-check-label" :for="'ice' + key"
                      >{{ ice }}</label
                    >
                  </div>
                </div>
                <div class="mb-3">
                  <label for="productSugar" class="form-label d-block"
                    >甜度*</label
                  >
                  <div
                    class="form-check form-check-inline"
                    v-for="(sugar, key) in sugarType"
                    :key="'sugar' + key"
                  >
                    <!-- HTML 屬性綁定 :disabled -->
                    <input
                      class="form-check-input"
                      name="sugarType"
                      type="radio"
                      :id="'sugar' + key"
                      :value="sugar"
                      v-model="itemSelected.sugar"
                      :disabled="!itemSelected.hasOwnProperty('defaults') || (itemSelected.defaults.sugar !== '' && itemSelected.defaults.sugar !== sugar)"
                    />
                    <label class="form-check-label" :for="'sugar' + key"
                      >{{ sugar }}</label
                    >
                  </div>
                </div>
                <div class="mb-3">
                  <label for="productTopping" class="form-label d-block"
                    >加料</label
                  >
                  <div
                    class="form-check form-check-inline"
                    v-for="(topping, key) in toppingsType"
                    :key="'topping' + key"
                  >
                    <!-- HTML 屬性綁定 :disabled -->
                    <input
                      class="form-check-input"
                      type="checkbox"
                      :id="'topping' + key"
                      :value="topping"
                      v-model="itemSelected.toppings"
                      :disabled="!itemSelected.hasOwnProperty('defaults') || (itemSelected.defaults.toppings.includes(topping))"
                    />
                    <label class="form-check-label" :for="'topping' + key"
                      >{{ topping }}</label
                    >
                  </div>
                </div>
                <div class="mb-3">
                  <label for="productNotice" class="form-label">備註</label>
                  <textarea
                    class="form-control"
                    id="productNotice"
                    rows="2"
                    v-model="itemSelected.notice"
                  ></textarea>
                </div>
                <div class="d-flex gap-2">
                  <button
                    class="btn btn-outline-primary w-100"
                    @click.prevent="resetOrder"
                    type="button"
                  >
                    取消
                  </button>
                  <!-- HTML 屬性綁定 :disabled -->
                  <button
                    class="btn btn-primary w-100"
                    @click.prevent="addToOrder(itemSelected)"
                    :disabled="!itemSelected.hasOwnProperty('name')"
                    type="button"
                  >
                    加入
                  </button>
                </div>
              </div>
            </div>
            <!-- 條件判斷 v-if -->
            <div class="card" v-if="orderList.length > 0">
              <div class="card-body">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">品項</th>
                      <th scope="col">冰塊</th>
                      <th scope="col">甜度</th>
                      <th scope="col">加料</th>
                      <th scope="col">單價</th>
                      <th scope="col">數量</th>
                      <th scope="col">小計</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- 多筆資料渲染 v-for -->
                    <tr v-for="(item, key) in orderList" :key="'order' + key">
                      <th scope="row">
                        {{ item.name }}<br />
                        <!-- 條件判斷 v-if -->
                        <small
                          v-if="item.notice !== ''"
                          class="text-muted fw-normal"
                          >備註：{{ item.notice }}</small
                        >
                      </th>
                      <td>{{ item.ice }}</td>
                      <td>{{ item.sugar }}</td>
                      <td>{{ item.toppings.toString() }}</td>
                      <td>{{ item.price + item.toppings.length * 10 }}</td>
                      <td>{{ item.count }}</td>
                      <td class="text-end">{{ item.total }}</td>
                    </tr>
                  </tbody>
                </table>
                <p class="text-end">共 NT$ {{ orderTotal }} 元</p>
                <!-- HTML 屬性綁定 :disabled -->
                <!-- 事件觸發 v-on generateOrder() -->
                <button
                  class="btn btn-sm btn-primary w-100"
                  :disabled="orderList.length === 0"
                  @click.prevent="generateOrder(orderList, orderTotal)"
                >
                  產生訂單
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- 產生訂單 -->
      <!-- 條件判斷 v-if -->
      <div class="bg-light p-3 mt-3" v-if="checkedOrder.orders.length > 0">
        <div class="bg-white p-3 d-flex flex-column" style="min-height: 450px">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">品項</th>
                <th scope="col">冰塊</th>
                <th scope="col">甜度</th>
                <th scope="col">加料</th>
                <th scope="col">單價</th>
                <th scope="col">數量</th>
                <th scope="col">小計</th>
              </tr>
            </thead>
            <tbody>
              <!-- 多筆資料渲染 v-for -->
              <tr
                v-for="(item, key) in checkedOrder.orders"
                :key="'order' + key"
              >
                <th scope="row">
                  {{ item.name }}<br />
                  <!-- 條件判斷 v-if -->
                  <small v-if="item.notice !== ''" class="text-muted fw-normal"
                    >備註：{{ item.notice }}</small
                  >
                </th>
                <td>{{ item.ice }}</td>
                <td>{{ item.sugar }}</td>
                <td>{{ item.toppings.toString() }}</td>
                <td>{{ item.price + item.toppings.length * 10 }}</td>
                <td>{{ item.count }}</td>
                <td class="text-end">{{ item.total }}</td>
              </tr>
            </tbody>
          </table>
          <p class="mt-3 mb-1">訂單成立時間：{{ checkedOrder.time }}</p>
          <p class="mb-1">餐點數： {{ checkedOrder.orders.length }}</p>
          <p class="mb-1">付款狀態：未付款</p>
          <p class="text-end mt-auto">共 NT$ {{ checkedOrder.total }} 元</p>
        </div>
      </div>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Bootstrap 5 JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const app = {
        // 資料 (函式)
        data() {
          return {
            itemSelected: {},
            orderList: [],
            orderTotal: 0,
            // 確認訂單
            checkedOrder: {
              time: "",
              total: 0,
              orders: [],
            },
            iceType: ["正常冰", "少冰", "微冰", "去冰", "熱"],
            sugarType: ["全糖", "七分", "半糖", "三分", "無糖"],
            toppingsType: ["珍珠", "粉條", "小粉圓", "椰果", "芋頭"],
            products: [
              {
                name: "珍珠鮮奶茶",
                engName: "Pearl Milk Tea",
                price: 60,
                defaults: {
                  toppings: ["珍珠"],
                  sugar: "",
                  ice: "",
                },
              },
              {
                name: "椰果鮮奶茶",
                engName: "Coconut Milk Tea",
                price: 60,
                defaults: {
                  toppings: ["椰果"],
                  sugar: "",
                  ice: "",
                },
              },
              {
                name: "鮮奶茶",
                engName: "Milk Tea",
                price: 50,
                defaults: {
                  toppings: [""],
                  sugar: "",
                  ice: "",
                },
              },
              {
                name: "古意冬瓜茶 (糖固定)",
                engName: "Winter Melon Drink",
                price: 30,
                defaults: {
                  toppings: [""],
                  sugar: "全糖",
                  ice: "",
                },
              },
              {
                name: "蜜香紅茶",
                engName: "Black Tea",
                price: 30,
                defaults: {
                  toppings: [""],
                  sugar: "",
                  ice: "",
                },
              },
              {
                name: "包種青茶",
                engName: "Pouchong tea",
                price: 35,
                defaults: {
                  toppings: [""],
                  sugar: "",
                  ice: "",
                },
              },
              {
                name: "檸檬烏龍",
                engName: "Lemon Oolong Tea",
                price: 55,
                defaults: {
                  toppings: [""],
                  sugar: "",
                  ice: "",
                },
              },
              {
                name: "薑母茶 (熱飲)",
                engName: "Ginger Tea",
                price: 55,
                defaults: {
                  toppings: [""],
                  sugar: "",
                  ice: "熱",
                },
              },
              {
                name: "青草茶",
                engName: "Herbal Tea",
                price: 35,
                defaults: {
                  toppings: [""],
                  sugar: "",
                  ice: "",
                },
              },
              {
                name: "金桔檸檬",
                engName: "Kumquat Lemonade",
                price: 40,
                defaults: {
                  toppings: [""],
                  sugar: "",
                  ice: "",
                },
              },
              {
                name: "柳澄青茶",
                engName: "Orange Mountain Tea",
                price: 45,
                defaults: {
                  toppings: [""],
                  sugar: "",
                  ice: "",
                },
              },
            ],
          };
        },
        // 生命週期 (函式)
        created() {
          console.log(this);
        },
        // 方法 (物件)
        methods: {
          // 選擇飲品
          selectProduct(product) {
            this.itemSelected = {
              ...product,
              count: 1,
              toppings: [],
              // 三元運算子
              ice:
                product.defaults.ice !== "" ? product.defaults.ice : "正常冰",
              sugar:
                product.defaults.sugar !== "" ? product.defaults.sugar : "全糖",
              notice: "",
            };
          },
          // 加入品項
          addToOrder(product) {
            const order = {
              ...product,
              total:
                (product.price + product.toppings.length * 10) * product.count,
            };
            this.orderList.push(order);
            this.countTotal();
            this.resetOrder();
          },
          // 計算總價
          countTotal() {
            // reduce 將陣列化為單一值
            this.orderTotal = this.orderList.reduce(
              (acc, obj) => acc + obj.total,
              0
            );
          },
          resetOrder() {
            this.itemSelected = {};
          },
          // 產生訂單
          generateOrder(orders, total) {
            const date = new Date().toLocaleString();
            this.checkedOrder.time = date;
            this.checkedOrder.orders = orders;
            this.checkedOrder.total = total;
            this.orderList = [];
            this.resetOrder();
          },
        },
      };

      Vue.createApp(app).mount("#app");
    </script>
  </body>
</html>
